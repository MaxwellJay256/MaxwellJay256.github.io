[{"content":"最近在尝试使用 WSL 2 作为开发 ESP-32 的工具，但是 WSL 不像 VMWare 虚拟机那样可以直接访问硬件，而是一个纯虚拟环境，无法直接访问 USB 设备，所以需要一些额外的工具来实现 USB 设备的共享。\n参考资料：WSL/连接 USB 设备 - Microsoft Learn\n先决条件 Windows 11（内部版本 22000 或更高版本） 具有 x64/x86 处理器的计算机 Linux 发行版已安装并设置为 WSL 2（本次使用的是 Ubuntu 20.04 LTS） 1. 安装 USPIPD-WIN 项目 方法 1：从 GitHub 下载安装 仓库链接：usbipd-win\n方法 2：使用 Windows 程序包管理器程序 (winget) 安装 打开 PowerShell 并运行以下命令：\nwinget install --interactive --exact dorssel.usbipd-win 2. 在 Linux 中安装 USBIP 工具和硬件数据库 在 Ubuntu 中，运行以下命令安装工具和硬件数据库：\nsudo apt install linux-tools-generic hwdata 每次要启动 USBIP 服务时，运行以下命令：\nsudo update-alternatives --install /usr/local/bin/usbip usbip /usr/lib/linux-tools/*-generic/usbip 20 此时，一个服务就会在 Windows 上运行以共享 USB 设备，并且在 WSL 中安装了必要的工具来连接到共享设备。\n3. 附加 USB 设备 通过管理员模式打开 PowerShell 并运行以下命令，列出所有连接到 Windows 的 USB 设备：\nusbipd wsl list 本次实验连接的是一个 ESP-32 Devkit-M，输出如下：\n这里面 Silicon Labs CP210x USB to UART Bridge (COM5) 就是我们想要连接的开发板了，2-1 就是它的设备总线 ID。\n选择要附加到 WSL 的设备总线 ID，然后运行以下命令：\nusbipd wsl attach --busid \u0026lt;bus_id\u0026gt; 其中 \u0026lt;bus_id\u0026gt; 是要附加的设备总线 ID，即步骤 1 中输出的“2-1”。 此时设备就会从 Windows 上断开连接，并且在 WSL 上显示为一个 USB 设备。\n在 Ubuntu 中，运行以下命令，列出所有连接到 WSL 的 USB 设备：\nlsusb 然后就成功显示到了开发板：\n4. 测试连接以及断开连接 我提前在 WSL 上用 esp-idf 工具链编译了一个简单的 hello-world 程序，现在尝试用 esp-idf 工具链将 WSL 中的项目烧录到开发板上。\n通过 ls /dev/tty* 命令查找到开发板的串口设备为 /dev/ttyUSB0，所以可以运行以下命令烧录程序：\nidf.py -p /dev/ttyUSB0 flash 我也尝试了直接使用设备总线 ID 来烧录程序，但没有成功……\nidf.py -p /dev/bus/usb/002/001 flash 输出如下：\nesptool.py v3.3.4-dev Serial port /dev/bus/usb/002/001 Traceback (most recent call last): File \u0026#34;/home/jay/.espressif/python_env/idf4.4_py3.8_env/lib/python3.8/site-packages/serial/serialposix.py\u0026#34;, line 322, in open self.fd = os.open(self.portstr, os.O_RDWR | os.O_NOCTTY | os.O_NONBLOCK) PermissionError: [Errno 13] Permission denied: \u0026#39;/dev/bus/usb/002/001\u0026#39; 嘛，不管那个了，运行串口监视器，可以看到开发板是正常运行的：\nidf.py -p /dev/ttyUSB0 monitor 使用结束后，其实可以直接将 USB 设备从电脑上拔出，或者在管理员模式下运行 PowerSheell 命令来断开连接：\nusbipd wsl detach --busid \u0026lt;busid\u0026gt; 实际操作下来，使用命令断开 WSL 的 USB 连接后，Windows 上的设备管理器中又显示出了设备。\n","date":"2023-11-24T20:56:12+08:00","image":"https://maxwelljay256.github.io/post/wsl-connect-usb/ESP32-Devkit_hu053b9317d90769e57a9b8211317cf12c_1799982_120x120_fill_q75_box_smart1.jpg","permalink":"https://maxwelljay256.github.io/post/wsl-connect-usb/","title":"笔记：将 USB 设备连接到 WSL"},{"content":"2023 年 11 月 17 日，Maxwell Jay 的幻想乡正式建成。\n","date":"2023-11-17T16:22:12+08:00","permalink":"https://maxwelljay256.github.io/post/hello-world/","title":"你好，世界！"}]